# ECG Denoising

## 1. Main Goal

In order to measure the power of the noise simulated and added to the current signals we are going to use the Signal-to-Noise Ratio (SNR). This measure is defined as the ration of signal power over the noise power and it is measured in decibels.

$$SNR = \frac{P_{signal}}{P_{noise}} $$
$$\implies {SNR}_{dB} = 10\log _{10}(SNR)$$

## 2. Type of noise in ECGs

In this section, we will describe all the predominant types of noise in ECG signals, and we will use the sinusoidal signal formula to simulate them:

$s(t)=A×sin⁡(\omega \times t+\phi)$

• $A$ is the amplitude
• $\omega$ is the angular frequency, $\omega = 2\pi f$ with $f$ the frequency
• $t$ is the time step
• $\psi$ is the initial phase
### 2.1 Persistent Noises

#### 2.1.1 Power-Line Interference  

**Power Line Interference (PLI) noise** is caused by signal cables running from the examination room to the monitoring equipment, which are exposed to electromagnetic fields at 50 Hz or 60 Hz, generated by omnipresent power supply lines.

High-frequency noise is induced by **capacitive coupling**, which refers to the transfer of energy between two circuits via a capacitance. This coupling decreases as the distance between the circuits increases.

In contrast, **low-frequency noise** is generated by **inductive coupling**, which occurs when current flowing through a wire produces a magnetic field that induces current in nearby conductors.

To simulate this type of noise, we use a sinusoidal signal :

$$
PLI_{50,60Hz}(t) = A \cdot \sin(2\pi f t + \phi)
$$

Where:

- $A$ is the amplitude of the noise  
- $f$ is either 50 Hz or 60 Hz  
- $\phi$ is the random phase in the interval $[0,\ 2\pi)$


#### 2.1.2 Baseline Wander  

**Variations in electrode-skin impedance** (the electrical resistance between the electrode and the skin), caused by factors such as humidity, skin characteristics, or the pressure of the electrode on the skin, as well as **patient movements, electrode displacement, and breathing**, can generate **Baseline Wander (BW) noise**.

This type of noise is characterized by an unstable isoelectric line that shifts over time. Its **frequency** is generally **below 1 Hz**, but in **certain situations** — such as during transport in ambulances — this frequency **can be higher**.

An approximation of this signal can be modeled as a linear combination of sinusoidal functions with frequencies ranging from 0 Hz to 0.5 Hz. The amplitude and the phase of each component are randomly chosen to ensure variability and avoid deterministic patterns.

The model is defined as:

$$
BW(t) = C \times \sum^{K}_{k=0} a_k \cdot \cos(2\pi k \Delta f \cdot t + \phi_k)
$$

Where:

- $C$: scaling factor to control the total power of the noise and adjust the Signal-to- Ratio (SNR)  
- $\Delta f = \frac{f_s}{N}$, with $f_s$: the sampling frequency, and $N$: the total number of samples  
- $K = \frac{f_c}{\Delta f}$: the number of sinusoidal components, with $f_c = 0.5$ Hz being the maximum frequency of the noise  
- $a_k$: a random number drawn from a uniform distribution in $[0, 1]$  
- $\phi_k$: a random phase drawn from the interval $[0, 2\pi)$  

#### 2.1.3 Electromyographic  

**Electromyographic (EMG) noise** is caused by the contraction of other muscles than the heart which creates wave detected by the electrodes. The **power** level of the noise in influenced by the **intensity of the contractions** and **quality of the electrodes**.

It is said that this **noise** can be simulated by a **gaussian distribution** with a **mean of zero** and a **variance** that depends on **many factors**.

### 2.2 Burst Noises

**Burst noise** is a type of noise that appears on a subset of leads for a very short duration. It is often classified as **White Gaussian noise**.


#### 2.2.1 Electrode Motion Artifact 

**Electrode Motion Artifact (EMA) noise** is primarily caused by skin stretching, which modifies the electrode-skin impedance. This noise typically occurs during ambulatory ECGs. Its appearance is **similar to baseline wander (BW) noise** but with **larger amplitude** waveforms, and it occurs in the frequency range of **1 Hz to 10 Hz**.

#### 2.2.2 Electrode Popup 

**Electrode pop-up noise** occurs due to variations in the position of the heart relative to the electrodes and changes in the medium between them. This noise is typically caused by an electrode being completely or nearly detached, or by patient movements.
It is characterized by sudden changes in the amplitude of the ECG signal, as well as low-frequency baseline shifts caused by variations in electrode-skin impedance. The higher the electrode-skin impedance, the more even small changes in impedance can lead to significant baseline shifts.

#### 2.2.3 Instrumentation Noise

The **electrical equipment** used in ECG measurements, such as electrode probes, cables, signal processors/amplifiers, also contributes to noise. 
One type of electrical noise is **resistor thermal noise**, which arises from fluctuations of electrons due to thermal agitation. 
This noise is given by:

$$S(f) = \frac{4kTR}{f}$$

where:
- $k$ is **Boltzmann's constant**
- $T$ is the **temperature**
- $R$ is the **resistance**


# Running the project

Make sure to follow the steps to be able to run the project  :
    
1. Create an virtual environment activate it and install the dependencies : 
    ```bash
    python3 -m venv .env
    source .env/bin/activate
    pip install -r requirements.txt
    ```
    
2. Download the database and add the `records100` and `records500` folders to `src/data/`. Then run: 
    ```bash
    python3 src/data.py
    ```
   This will extract the data from the original dataset and save it as `npz` files.